# PostgreSQL Client Authentication Configuration File
# For ChMS Production Environment
# Reference: PostgreSQL Configuration: Best Practices for Performance and Security

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# ============================================================================
# LOCAL CONNECTIONS (Unix Socket)
# ============================================================================

# Local connections on Unix socket - use scram-sha-256 (strongest password method)
local   all             all                                     scram-sha-256

# ============================================================================
# CONTAINER NETWORK CONNECTIONS
# ============================================================================

# Docker network connections (172.x.x.x range) - use scram-sha-256
host    all             chms_user       172.0.0.0/8             scram-sha-256

# Allow application containers to connect
host    all             chms_user       chms-network            scram-sha-256

# ============================================================================
# REPLICATION (If needed for read replicas)
# ============================================================================

# Replication connections (uncomment when setting up read replicas)
# host    replication     replicator       172.0.0.0/8             scram-sha-256

# ============================================================================
# SECURITY: DENY ALL OTHER CONNECTIONS
# ============================================================================

# Explicitly deny all other connections
host    all             all             0.0.0.0/0               reject

# ============================================================================
# NOTES
# ============================================================================
#
# Authentication Methods:
# - scram-sha-256: Strongest password-based authentication (recommended)
# - md5: Legacy method (avoid for production)
# - trust: No password required (NEVER use in production)
# - reject: Explicitly deny connection
#
# Security Best Practices:
# 1. Use scram-sha-256 for all password-based authentication
# 2. Restrict connections to specific IP ranges/networks
# 3. Use separate users for different purposes (application, admin, replication)
# 4. Regularly audit pg_hba.conf for unauthorized changes
# 5. Combine with firewall rules at OS level for defense in depth
#
# Docker Network Notes:
# - Docker creates networks in 172.x.x.x range by default
# - Adjust CIDR notation (172.0.0.0/8) to match your Docker network configuration
# - Test connections after changes to ensure application can still connect
#
# Example Secure Configuration:
# - Local connections: Unix socket with scram-sha-256
# - Container network: Docker network range with scram-sha-256
# - All others: Explicitly rejected
#

